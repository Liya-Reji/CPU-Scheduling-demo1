<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Round Robin Scheduling with Averages</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #1a73e8, black);
      min-height: 100vh;
      color: #f0f0f0;
      text-align: center;
    }
    h1 { color: #f0f0f0; text-shadow: 2px 2px 4px #000; }
    h2 { color: #f0f0f0; }
    button {
      padding: 10px 20px;
      margin: 8px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background: #333;
      transition: transform 0.2s, background 0.3s;
    }
    button:hover {
      background: #555;
      transform: scale(1.05);
    }
    table {
      border-collapse: collapse;
      margin: 20px auto;
      width: 85%;
      background-color: rgba(255, 255, 255, 0.8);
      animation: fadeIn 1s ease-in;
    }
    th, td {
      border: 1px solid #444;
      padding: 6px;
      text-align: center;
      color: #2c3e50;
    }
    th {
      background: #444;
      color: #fff;
    }
    .gantt {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
      animation: slideIn 1s ease-out;
    }
    .block {
      border: 1px solid #000;
      padding: 10px;
      margin: 3px;
      border-radius: 6px;
      color: #fff;
      font-weight: bold;
      min-width: 50px;
      text-align: center;
      opacity: 0;
      animation: fadeInBlock 0.8s forwards;
    }
    .P1 { background: #e17055; }
    .P2 { background: #d63031; }
    .P3 { background: #6c5ce7; }
    .P4 { background: #00b894; }

    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    @keyframes slideIn { from {transform: translateY(30px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    @keyframes fadeInBlock { from {opacity: 0; transform: scale(0.8);} to {opacity: 1; transform: scale(1);} }
  </style>
</head>
<body>
  <h1>âš¡ Round Robin Scheduling Demo (Time Quantum = 3)</h1>
  <p><b>Processes:</b> P1(AT=0,BT=5), P2(AT=1,BT=3), P3(AT=2,BT=8), P4(AT=3,BT=6)</p>

  <button onclick="runRR()">Run Round Robin</button>
  <div id="output"></div>

  <script>
    const processes = [
      {pid: "P1", at: 0, bt: 5},
      {pid: "P2", at: 1, bt: 3},
      {pid: "P3", at: 2, bt: 8},
      {pid: "P4", at: 3, bt: 6}
    ];
    const quantum = 3;

    function runRR() {
      let time = 0;
      let queue = [];
      let remaining = processes.map(p => p.bt);
      let ct = Array(processes.length).fill(0);
      let result = [];
      let gantt = [];

      // Sort by arrival time
      processes.sort((a, b) => a.at - b.at);

      queue.push(0); // push first process

      while (queue.length > 0) {
        let idx = queue.shift();
        if (remaining[idx] > 0) {
          let execTime = Math.min(quantum, remaining[idx]);
          gantt.push({ pid: processes[idx].pid, start: time, end: time + execTime });
          time += execTime;
          remaining[idx] -= execTime;

          // push newly arrived processes into queue
          for (let i = 0; i < processes.length; i++) {
            if (i !== idx && processes[i].at <= time && remaining[i] > 0 && !queue.includes(i)) {
              queue.push(i);
            }
          }
          // re-add current process if still remaining
          if (remaining[idx] > 0) queue.push(idx);
          else ct[idx] = time;
        }
      }

      // Calculate TAT and WT
      let final = processes.map((p, i) => {
        let tat = ct[i] - p.at;
        let wt = tat - p.bt;
        return { pid: p.pid, at: p.at, bt: p.bt, ct: ct[i], tat, wt };
      });

      showResultWithAverages("Round Robin (Quantum = " + quantum + ")", final, gantt);
    }

    function showResultWithAverages(title, result, gantt) {
      let output = `<h2>${title}</h2>`;
      output += "<table><tr><th>PID</th><th>AT</th><th>BT</th><th>CT</th><th>TAT</th><th>WT</th></tr>";
      let totalTAT = 0, totalWT = 0;

      result.forEach(r => {
        output += `<tr>
          <td>${r.pid}</td>
          <td>${r.at}</td>
          <td>${r.bt}</td>
          <td>${r.ct}</td>
          <td>${r.tat}</td>
          <td>${r.wt}</td>
        </tr>`;
        totalTAT += r.tat;
        totalWT += r.wt;
      });

      const avgTAT = (totalTAT / result.length).toFixed(2);
      const avgWT = (totalWT / result.length).toFixed(2);

      output += "</table>";
      output += `<p><strong>Average Turnaround Time (TAT):</strong> ${avgTAT}</p>`;
      output += `<p><strong>Average Waiting Time (WT):</strong> ${avgWT}</p>`;

      output += "<div class='gantt'>";
      gantt.forEach((g, i) => {
        output += `<div class='block ${g.pid}' style="animation-delay:${i * 0.2}s">${g.pid}</div>`;
      });
      output += "</div>";

      document.getElementById("output").innerHTML = output;
    }
  </script>
</body>
</html>
